<header class="app-header" [class.app-header--minimal]="!isAuthenticated()">
  @if (isAuthenticated()) {
    <div class="wrap">
      <a class="brand" routerLink="/">
        <img src="/icon.svg" alt="TaskGroup logo" class="brand-logo" width="48" height="48" loading="eager" />
        <span class="brand-title">{{ 'common.appName' | translate }}</span>
      </a>
      <nav class="nav-links">
        <a class="nav-link" routerLink="/list" routerLinkActive="active">{{ 'projects.list.title' | translate }}</a>
        <a class="nav-link" routerLink="/contact" routerLinkActive="active">{{ 'header.nav.contact' | translate }}</a>
      </nav>
      <div class="spacer"></div>
      <div class="language-dropdown" [class.open]="languageMenuOpen()" aria-label="{{ 'header.language.label' | translate }}">
        <button
          type="button"
          class="language-dropdown__trigger"
          aria-haspopup="listbox"
          [attr.aria-expanded]="languageMenuOpen()"
          (click)="toggleLanguageMenu()"
        >
          <span class="language-dropdown__icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="9"></circle>
              <path d="M3 12h18"></path>
              <path d="M12 3a15 15 0 0 1 0 18"></path>
              <path d="M12 3a15 15 0 0 0 0 18"></path>
            </svg>
          </span>
          <span class="language-dropdown__value">{{ language().toUpperCase() }}</span>
          <span class="language-dropdown__caret" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
              <path d="M6 9l6 6 6-6"></path>
            </svg>
          </span>
        </button>
        @if (languageMenuOpen()) {
          <div class="language-dropdown__menu" role="menu">
            <ul class="language-dropdown__list" role="listbox">
              @for (lang of languages; track lang.code) {
                <li>
                  <button
                    type="button"
                    class="language-dropdown__option"
                    role="option"
                    [class.active]="language() === lang.code"
                    [attr.aria-selected]="language() === lang.code"
                    (click)="changeLanguage(lang.code)"
                  >
                    <span class="language-dropdown__option-code">{{ lang.code.toUpperCase() }}</span>
                    <span class="language-dropdown__option-label">{{ lang.labelKey | translate }}</span>
                    @if (language() === lang.code) {
                      <span class="language-dropdown__option-check" aria-hidden="true">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M5 13l4 4L19 7"></path>
                        </svg>
                      </span>
                    }
                  </button>
                </li>
              }
            </ul>
          </div>
        }
      </div>
      <button class="btn ghost" type="button" (click)="toggleTheme()" aria-label="{{ 'header.theme.label' | translate }}">
        {{ theme() === 'dark' ? ('header.theme.light' | translate) : ('header.theme.dark' | translate) }}
      </button>
      @if (user(); as currentUser) {
        <button class="pill pill-action" type="button" routerLink="/profile">
          {{ 'header.greeting' | translate }}, {{ currentUser.alias }}
        </button>
        <button class="btn danger" type="button" (click)="logout()">{{ 'header.logout' | translate }}</button>
      }
    </div>
  } @else {
    <div class="wrap auth-header-minimal">
      <div class="auth-header-actions">
        <div class="language-dropdown" [class.open]="languageMenuOpen()" aria-label="{{ 'header.language.label' | translate }}">
          <button
            type="button"
            class="language-dropdown__trigger"
            aria-haspopup="listbox"
            [attr.aria-expanded]="languageMenuOpen()"
            (click)="toggleLanguageMenu()"
          >
            <span class="language-dropdown__icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="9"></circle>
                <path d="M3 12h18"></path>
                <path d="M12 3a15 15 0 0 1 0 18"></path>
                <path d="M12 3a15 15 0 0 0 0 18"></path>
              </svg>
            </span>
            <span class="language-dropdown__value">{{ language().toUpperCase() }}</span>
            <span class="language-dropdown__caret" aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path d="M6 9l6 6 6-6"></path>
              </svg>
            </span>
          </button>
          @if (languageMenuOpen()) {
            <div class="language-dropdown__menu" role="menu">
              <ul class="language-dropdown__list" role="listbox">
                @for (lang of languages; track lang.code) {
                  <li>
                    <button
                      type="button"
                      class="language-dropdown__option"
                      role="option"
                      [class.active]="language() === lang.code"
                      [attr.aria-selected]="language() === lang.code"
                      (click)="changeLanguage(lang.code)"
                    >
                      <span class="language-dropdown__option-code">{{ lang.code.toUpperCase() }}</span>
                      <span class="language-dropdown__option-label">{{ lang.labelKey | translate }}</span>
                      @if (language() === lang.code) {
                        <span class="language-dropdown__option-check" aria-hidden="true">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 13l4 4L19 7"></path>
                          </svg>
                        </span>
                      }
                    </button>
                  </li>
                }
              </ul>
            </div>
          }
        </div>
        <button class="btn ghost" type="button" (click)="toggleTheme()" aria-label="{{ 'header.theme.label' | translate }}">
          {{ theme() === 'dark' ? ('header.theme.light' | translate) : ('header.theme.dark' | translate) }}
        </button>
        @if (!isLoginRoute()) {
          <a class="btn primary" routerLink="/login">
            {{ 'header.login' | translate }}
          </a>
        }
      </div>
    </div>
  }
</header>

<main class="container" [class.container--landing]="!isAuthenticated() && !isLoginRoute()">
  @if (isAuthenticated() || isLoginRoute()) {
    <router-outlet></router-outlet>
  } @else {
    <app-landing-page></app-landing-page>
  }
</main>

<footer class="footer" [class.footer--overlay]="!isAuthenticated()">
  © {{ 'common.appName' | translate }} · 2025
</footer>
