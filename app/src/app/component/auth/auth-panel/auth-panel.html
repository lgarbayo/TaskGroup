<section class="auth-card card pad stack-md">
  @if (!isAuthenticated()) {
    <header class="stack-xs">
      <p class="subtitle">{{ 'auth.title' | translate }}</p>
      <h2 class="title">{{ 'auth.subtitle' | translate }}</h2>
    </header>

    <div class="tab-bar">
      <button
        class="tab"
        [class.active]="mode() === 'login'"
        type="button"
        (click)="switchMode('login')"
      >
        {{ 'auth.tab.login' | translate }}
      </button>
      <button
        class="tab"
        [class.active]="mode() === 'register'"
        type="button"
        (click)="switchMode('register')"
      >
        {{ 'auth.tab.register' | translate }}
      </button>
    </div>

    @if (mode() === 'login') {
      <form class="stack-sm" (ngSubmit)="submitLogin()" [formGroup]="loginForm">
        <label class="stack-xxs">
          <span>{{ 'auth.field.email' | translate }}</span>
          <input
            type="email"
            formControlName="email"
            [placeholder]="'auth.placeholder.email' | translate"
            [class.invalid]="loginForm.controls.email.invalid && loginForm.controls.email.touched"
          />
        </label>
        <label class="stack-xxs">
          <span>{{ 'auth.field.password' | translate }}</span>
          <div class="password-field">
            <input
              [type]="loginPasswordVisible() ? 'text' : 'password'"
              formControlName="password"
              [placeholder]="'auth.placeholder.password' | translate"
              [class.invalid]="loginForm.controls.password.invalid && loginForm.controls.password.touched"
            />
            <button
              type="button"
              class="password-toggle"
              (click)="toggleLoginPasswordVisibility()"
              [attr.aria-label]="loginPasswordVisible() ? ('auth.password.hide' | translate) : ('auth.password.show' | translate)"
            >
              {{ loginPasswordVisible() ? 'ğŸ™ˆ' : 'ğŸ‘' }}
            </button>
          </div>
        </label>
        <button class="btn" type="submit" [disabled]="loading()">
          {{ 'auth.submit.login' | translate }}
        </button>
      </form>
    } @else {
      <form class="stack-sm" (ngSubmit)="submitRegister()" [formGroup]="registerForm" novalidate>
        <label class="stack-xxs">
          <span>{{ 'auth.field.alias' | translate }}</span>
          <input
            type="text"
            formControlName="alias"
            [placeholder]="'auth.placeholder.alias' | translate"
            [class.invalid]="inputInvalid('alias')"
          />
          @if (inputInvalid('alias')) {
            <small class="error">
              @if (registerForm.controls.alias.errors?.['pattern']) {
                {{ 'auth.error.aliasPattern' | translate }}
              } @else {
                {{ 'auth.error.aliasRequired' | translate }}
              }
            </small>
          }
        </label>
        <label class="stack-xxs">
          <span>{{ 'auth.field.name' | translate }}</span>
          <input
            type="text"
            formControlName="name"
            [placeholder]="'auth.placeholder.name' | translate"
          />
        </label>
        <label class="stack-xxs">
          <span>{{ 'auth.field.email' | translate }}</span>
          <input
            type="email"
            formControlName="email"
            [placeholder]="'auth.placeholder.email' | translate"
            [class.invalid]="inputInvalid('email')"
          />
          @if (inputInvalid('email')) {
            <small class="error">{{ 'auth.error.email' | translate }}</small>
          }
        </label>
        <label class="stack-xxs">
          <span>{{ 'auth.field.password' | translate }}</span>
          <div class="password-field">
            <input
              [type]="registerPasswordVisible() ? 'text' : 'password'"
              formControlName="password"
              [placeholder]="'auth.placeholder.password' | translate"
              [class.invalid]="inputInvalid('password')"
            />
            <button
              type="button"
              class="password-toggle"
              (click)="toggleRegisterPasswordVisibility()"
              [attr.aria-label]="registerPasswordVisible() ? ('auth.password.hide' | translate) : ('auth.password.show' | translate)"
            >
              {{ registerPasswordVisible() ? 'ğŸ™ˆ' : 'ğŸ‘' }}
            </button>
          </div>
          @if (inputInvalid('password')) {
            <small class="error">{{ 'auth.error.password' | translate }}</small>
          }
        </label>
        <button class="btn" type="submit" [disabled]="loading()">
          {{ 'auth.submit.register' | translate }}
        </button>
      </form>
    }

    @if (errorMessage(); as error) {
      <p class="error">
        @if (error.key) {
          {{ error.key | translate:error.params }}
        } @else if (error.raw) {
          {{ error.raw }}
        }
      </p>
    }
  } @else {
    @if (user(); as currentUser) {
      <div class="stack-sm">
        <p class="subtitle">{{ 'auth.logged.title' | translate }}</p>
        <h2 class="title">{{ 'auth.logged.subtitle' | translate:{ name: currentUser.alias } }}</h2>
        <p class="muted">{{ 'auth.logged.email' | translate:{ email: currentUser.email } }}</p>
        <button class="btn ghost" type="button" (click)="logout()">
          {{ 'auth.logged.logout' | translate }}
        </button>
      </div>
    }
  }
</section>
