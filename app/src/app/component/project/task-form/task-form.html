<form [formGroup]="form" (ngSubmit)="save()">
  <div class="field-group">
    <label>{{ 'form.task.title' | translate }}</label>
    <input formControlName="title" [class.invalid]="form.controls.title.invalid && form.controls.title.touched" />
    @if (form.controls.title.invalid && form.controls.title.touched) {
      <small>⚠️ {{ 'form.task.titleRequired' | translate }}</small>
    }
  </div>

  <div class="field-group">
    <label>{{ 'form.task.description' | translate }}</label>
    <textarea rows="2" formControlName="description"></textarea>
  </div>

  <div class="field-group">
    <label>{{ 'form.task.duration' | translate }}</label>
    <input
      type="number"
      min="1"
      formControlName="durationWeeks"
      [class.invalid]="form.controls.durationWeeks.invalid && form.controls.durationWeeks.touched"
    />
    @if (form.controls.durationWeeks.invalid && form.controls.durationWeeks.touched) {
      <small>⚠️ {{ 'form.task.durationRequired' | translate }}</small>
    }
  </div>

  <div class="field-group">
    <label>{{ 'form.task.status' | translate }}</label>
    <select formControlName="status">
      @for (status of statuses; track status.value) {
        <option [value]="status.value">{{ status.label | translate }}</option>
      }
    </select>
  </div>

  <div class="field-group">
    <label>{{ 'form.task.assignee' | translate }}</label>
    <select formControlName="assigneeId">
      <option [ngValue]="null">{{ 'form.task.assignee.none' | translate }}</option>
      @for (member of members(); track member.id) {
        <option [ngValue]="member.id">{{ member.alias }} · {{ member.email }}</option>
      }
    </select>
  </div>

  <div class="field-group">
    <label>{{ 'form.task.milestone' | translate }}</label>
    <select formControlName="milestoneUuid">
      <option [ngValue]="null">{{ 'form.task.milestone.none' | translate }}</option>
      @for (milestone of milestones(); track milestone.uuid) {
        <option [ngValue]="milestone.uuid">{{ milestone.title }}</option>
      }
    </select>
  </div>

  <fieldset formGroupName="startDate">
    <legend>{{ 'form.task.start' | translate }}</legend>
    <div class="fieldset-grid">
      <div>
        <label>{{ 'form.project.year' | translate }}</label>
        <input
          type="number"
          formControlName="year"
          [class.invalid]="form.controls.startDate.controls.year.invalid && form.controls.startDate.controls.year.touched"
        />
      </div>
      <div>
        <label>{{ 'form.project.month' | translate }}</label>
        <select
          formControlName="month"
          [class.invalid]="form.controls.startDate.controls.month.invalid && form.controls.startDate.controls.month.touched"
        >
        @for (month of core.monthNames(); track month; let idx = $index) {
          <option [value]="idx">{{ month }}</option>
        }
        </select>
      </div>
      <div>
        <label>{{ 'form.project.week' | translate }}</label>
        <select
          formControlName="week"
          [class.invalid]="form.controls.startDate.controls.week.invalid && form.controls.startDate.controls.week.touched"
        >
          <option [value]="0">1</option>
          <option [value]="1">2</option>
          <option [value]="2">3</option>
          <option [value]="3">4</option>
        </select>
      </div>
    </div>
    @if (form.controls.startDate.touched && form.controls.startDate.errors?.['projectRange']) {
      <small>⚠️ {{ 'form.task.range.project' | translate }}</small>
    }
    @if (form.controls.startDate.touched && form.controls.startDate.errors?.['milestoneRange']) {
      <small>⚠️ {{ 'form.task.range.milestone' | translate }}</small>
    }
  </fieldset>

  <div class="form-actions">
    <button class="btn primary" type="submit">
      @if (isEditing()) {
        {{ 'form.task.submit.update' | translate }}
      } @else {
        {{ 'form.task.submit' | translate }}
      }
    </button>
    @if (isEditing()) {
      <button class="btn ghost" type="button" (click)="cancelEdit()">
        {{ 'form.task.cancel' | translate }}
      </button>
    }
  </div>
</form>
